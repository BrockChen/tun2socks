// Copyright (C) 2016 sails Authors.
// All rights reserved.
//
// Official git repository and contact information can be found at
// https://github.com/sails/ and http://www.sailsxu.com/.
//
// Filename: checksum_test.cc
//
// Author: sailsxu <sailsxu@gmail.com>
// Created: 2016-11-14 15:28:20

#define CATCH_CONFIG_MAIN

#include <arpa/inet.h>
#include "catch.hpp"
#include "../src/checksum.h"



// capture bigEndian ip packets
uint8_t buf1[20] = {0x45, 0x00, 0x01, 0x48, 0x98, 0x1d, 0x00, 0x00,
                    0xff, 0x11, 0x22, 0x88, 0x00, 0x00, 0x00, 0x00,
                    0xff, 0xff, 0xff, 0xff};
uint8_t buf2[20] = {0x45, 0x00, 0x01, 0x89, 0x0d, 0x6c, 0x40, 0x00,
                    0x40, 0x06, 0xd5, 0x31, 0xc0, 0xa8, 0xc7, 0xf0,
                    0xb4, 0xa3, 0x19, 0x95};
uint8_t buf3[20] = {0x45, 0x00, 0x00, 0x30, 0x80, 0x4c, 0x40, 0x00,
                    0x80, 0x06, 0xb5, 0x2e, 0xd3, 0x43, 0x11, 0x7b,
                    0xcb, 0x51, 0x15, 0x3d};
uint8_t buf4[20] = {0x45, 0x00, 0x00, 0xf4, 0x00, 0x2e, 0x00, 0x00,
                    0x80, 0x11, 0x00, 0x00, 0xc0, 0xa8, 0x09, 0x0a,
                    0xc0, 0xa8, 0x09, 0xff};


TEST_CASE("CheckSum", "ip check") {
  REQUIRE(ip_checksum(buf1, 20) == 0x2288);
  REQUIRE(ip_checksum(buf2, 20) == 0xd531);
  REQUIRE(ip_checksum(buf3, 20) == 0xb52e);
  REQUIRE(ip_checksum(buf4, 20) == 0xa571);
}


